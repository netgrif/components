<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Netgrif Components Core library Documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css" media="(prefers-color-scheme: dark)">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">Netgrif Components Core library Documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li
  >
  ViewNavigationItem</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>projects/netgrif-components-core/src/lib/navigation/navigation-double-drawer/abstract-navigation-double-drawer.ts</code>
        </p>



            <p class="comment">
                <h3>Extends</h3>
            </p>
            <p class="comment">
                        <code><a href="../interfaces/View.html" target="_self" >View</a></code>
            </p>

        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#id" 
>
                                            id
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#resource" 
>
                                            resource
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="id"></a>
                                        <span class="name "><b>id</b>
                                            <a href="#id">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>id:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="resource"></a>
                                        <span class="name "><b>resource</b>
                                            <a href="#resource">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>resource:         <code><a href="../interfaces/Case.html" target="_self" >Case</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="../interfaces/Case.html" target="_self" >Case</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {Component, Input, OnDestroy, OnInit, TemplateRef} from &#x27;@angular/core&#x27;;
import {forkJoin, Observable, Subscription} from &#x27;rxjs&#x27;;
import {ActivatedRoute, Router} from &#x27;@angular/router&#x27;;
import {BreakpointObserver, Breakpoints} from &#x27;@angular/cdk/layout&#x27;;
import {LanguageService} from &#x27;../../translate/language.service&#x27;;
import {UserService} from &#x27;../../user/services/user.service&#x27;;
import {LoggerService} from &#x27;../../logger/services/logger.service&#x27;;
import {ConfigurationService} from &#x27;../../configuration/configuration.service&#x27;;
import {UriService} from &#x27;../service/uri.service&#x27;;
import {UriNodeResource} from &#x27;../model/uri-resource&#x27;;
import {Case} from &#x27;../../resources/interface/case&#x27;;
import {
    DynamicNavigationRouteProviderService
} from &#x27;../../routing/dynamic-navigation-route-provider/dynamic-navigation-route-provider.service&#x27;;
import {LoadingEmitter} from &quot;../../utility/loading-emitter&quot;;
import {MatDrawerMode} from &quot;@angular/material/sidenav&quot;;
import {ResizeEvent} from &quot;angular-resizable-element&quot;;
import {User} from &quot;../../user/models/user&quot;;
import {RoleAccess, View} from &quot;../../../commons/schema&quot;;
import {NAE_ROUTING_CONFIGURATION_PATH} from &quot;../../routing/routing-builder/routing-builder.service&quot;;
import {AccessService} from &quot;../../authorization/permission/access.service&quot;;

export interface ConfigDoubleMenu {
    mode: MatDrawerMode;
    opened: boolean;
    disableClose: boolean;
    width: number;
}

export interface ViewNavigationItem extends View {
    id: string;
    resource?: Case
}

export const FILTER_IDENTIFIERS &#x3D; [
    &quot;preference_filter_item&quot;
];
export const FILTER_VIEW_TASK_TRANSITION_ID &#x3D; &#x27;view&#x27;;

const LEFT_DRAWER_DEFAULT_WIDTH &#x3D; 60;
const RIGHT_DRAWER_DEFAULT_WIDTH &#x3D; 240;
const RIGHT_DRAWER_DEFAULT_MIN_WIDTH &#x3D; 180;
const RIGHT_DRAWER_MAX_WIDTH &#x3D; 460;

@Component({
    selector: &#x27;ncc-abstract-navigation-double-drawer&#x27;,
    template: &#x27;&#x27;,
})
export abstract class AbstractNavigationDoubleDrawerComponent implements OnInit, OnDestroy {

    @Input() portalLeftMenu: TemplateRef&lt;any&gt;;
    @Input() portalRightMenu: TemplateRef&lt;any&gt;;
    @Input() imageRouterLink: string &#x3D; &quot;/&quot;;
    @Input() imageAlt: string &#x3D; &quot;Logo&quot;;
    @Input() image: string;
    @Input() profileRouterLink: string &#x3D; &quot;/profile&quot;;
    @Input() includeUser: boolean &#x3D; true;
    @Input() includeLanguage: boolean &#x3D; true;
    @Input() includeMoreMenu: boolean &#x3D; true;
    @Input() allClosable: boolean &#x3D; true;
    @Input() folderIcon: string &#x3D; &quot;folder&quot;;
    @Input() openedFolderIcon: string &#x3D; &quot;folder_open&quot;;
    @Input() filterIcon: string &#x3D; &quot;filter_alt&quot;;
    @Input() foldersCategoryName: string &#x3D; &#x27;toolbar.menu.folders&#x27;;
    @Input() viewsCategoryName: string &#x3D; &#x27;toolbar.menu.views&#x27;;

    /**
     * Array of folder nodes on left side
     * */
    leftNodes: Array&lt;UriNodeResource&gt;;

    /**
     * Array of folder nodes on right side
     * */
    rightNodes: Array&lt;UriNodeResource&gt;;

    /**
     * Processes that can be displayed under folders on right side menu
     * */
    views: Array&lt;ViewNavigationItem&gt;;

    moreMenuItems: Array&lt;ViewNavigationItem&gt;;

    protected _leftNodesSubscription: Subscription;
    protected _rightNodesSubscription: Subscription;
    protected _filtersSubscription: Subscription;
    protected _breakpointSubscription: Subscription;
    protected _rootSubscription: Subscription;
    protected _currentNodeSubscription: Subscription;

    /**
     * Currently display uri
     * Siblings of the node are on the left, children are on the right
     */
    currentNode: UriNodeResource

    leftLoading$: LoadingEmitter;
    rightLoading$: LoadingEmitter;

    protected _configLeftMenu: ConfigDoubleMenu &#x3D; {
        mode: &#x27;side&#x27;,
        opened: true,
        disableClose: false,
        width: LEFT_DRAWER_DEFAULT_WIDTH
    };
    protected _configRightMenu: ConfigDoubleMenu &#x3D; {
        mode: &#x27;side&#x27;,
        opened: true,
        disableClose: false,
        width: RIGHT_DRAWER_DEFAULT_WIDTH
    };

    protected _childCustomViews: { [uri: string]: { [key: string]: ViewNavigationItem } }

    protected constructor(protected _router: Router,
                          protected _activatedRoute: ActivatedRoute,
                          protected _breakpoint: BreakpointObserver,
                          protected _languageService: LanguageService,
                          protected _userService: UserService,
                          protected _accessService: AccessService,
                          protected _log: LoggerService,
                          protected _config: ConfigurationService,
                          protected _uriService: UriService,
                          protected _dynamicRoutingService: DynamicNavigationRouteProviderService) {
        this.leftNodes &#x3D; new Array&lt;UriNodeResource&gt;();
        this.rightNodes &#x3D; new Array&lt;UriNodeResource&gt;();
        this.views &#x3D; new Array&lt;ViewNavigationItem&gt;();
        this.leftLoading$ &#x3D; new LoadingEmitter();
        this.rightLoading$ &#x3D; new LoadingEmitter();
        this._childCustomViews &#x3D; {};
        this.moreMenuItems &#x3D; new Array&lt;ViewNavigationItem&gt;();
    }

    ngOnInit(): void {
        this._breakpointSubscription &#x3D; this._breakpoint.observe([Breakpoints.HandsetLandscape]).subscribe(() &#x3D;&gt; {
            if (this._breakpoint.isMatched(&#x27;(max-width: 959.99px)&#x27;)) {
                this.resolveLayout(false);
            } else {
                this.resolveLayout(true);
            }
        });
        if (!this.currentNode) {
            this.leftLoading$.on();
            this.rightLoading$.on();
        }
        this._currentNodeSubscription &#x3D; this._uriService.activeNode$.subscribe(node &#x3D;&gt; {
            this.currentNode &#x3D; node;
            if (!node) return;
            if (this.leftLoading$.isActive || this.rightLoading$.isActive) {
                this.leftLoading$.off();
                this.rightLoading$.off();
            }
            if (this._uriService.isRoot(node)) {
                this.leftNodes &#x3D; [];
                this.loadRightSide();
                return;
            }
            if (!this.leftNodes.find(n &#x3D;&gt; n.id &#x3D;&#x3D;&#x3D; node.id)) {
                this.loadLeftSide();
            }
            this.loadRightSide();
        });

        const viewConfigurationPath &#x3D; this._activatedRoute.snapshot.data[NAE_ROUTING_CONFIGURATION_PATH];
        if (!!viewConfigurationPath) {
            const viewConfiguration &#x3D; this._config.getViewByPath(viewConfigurationPath);
            Object.entries(viewConfiguration.children).forEach(([key, childView]) &#x3D;&gt; {
                this.resolveUriForChildViews(viewConfigurationPath + &#x27;/&#x27; + key, childView);
                this.resolveHiddenMenuItemFromChildViews(viewConfigurationPath + &#x27;/&#x27; + key, childView);
            });
        }
    }

    protected resolveUriForChildViews(configPath: string, childView: View): void {
        if (!childView.processUri) return;
        if (!this._accessService.canAccessView(childView, configPath)) return;
        if (!this._childCustomViews[childView.processUri]) {
            this._childCustomViews[childView.processUri] &#x3D; {};
        }
        this._childCustomViews[childView.processUri][configPath] &#x3D; {
            id: configPath,
            ...childView
        }
    }

    protected resolveHiddenMenuItemFromChildViews(configPath: string, childView: View): void {
        if (!childView.navigation) return;
        if (!this._accessService.canAccessView(childView, configPath)) return;
        // @ts-ignore
        if (!!(childView?.navigation?.hidden)) {
            this.moreMenuItems.push({
                id: configPath,
                ...childView
            });
        }
    }

    ngOnDestroy(): void {
        this._breakpointSubscription?.unsubscribe();
        this._leftNodesSubscription?.unsubscribe();
        this._rightNodesSubscription?.unsubscribe();
        this._filtersSubscription?.unsubscribe();
        this._rootSubscription?.unsubscribe();
        this._currentNodeSubscription?.unsubscribe();
        this.leftLoading$.complete();
        this.rightLoading$.complete();
    }

    get configLeftMenu() {
        return this._configLeftMenu;
    }

    get configRightMenu() {
        return this._configRightMenu;
    }

    toggleMenu() {
        this.toggleRightMenu();
        if (this.allClosable) {
            this.toggleLeftMenu();
        }
    }

    toggleLeftMenu() {
        this._configLeftMenu.opened &#x3D; !this._configLeftMenu.opened;
    }

    toggleRightMenu() {
        this._configRightMenu.opened &#x3D; !this._configRightMenu.opened;
    }

    protected resolveLayout(isLargeScreen: boolean): void {
        this._configLeftMenu &#x3D; isLargeScreen ? {
            mode: &#x27;side&#x27;,
            opened: true,
            disableClose: true,
            width: this._configLeftMenu.width
        } : {
            mode: &#x27;over&#x27;,
            opened: false,
            disableClose: false,
            width: this._configLeftMenu.width
        };
        this._configRightMenu &#x3D; isLargeScreen ? {
            mode: &#x27;side&#x27;,
            opened: true,
            disableClose: true,
            width: this._configRightMenu.width
        } : {
            mode: &#x27;over&#x27;,
            opened: false,
            disableClose: false,
            width: this._configRightMenu.width
        };
    }

    getLang() {
        return this._languageService.getLanguage();
    }

    logout(): void {
        this._userService.logout().subscribe(() &#x3D;&gt; {
            this._log.debug(&#x27;User is logged out&#x27;);
            if (this._config.get().services &amp;&amp; this._config.get().services.auth &amp;&amp; this._config.get().services.auth.logoutRedirect) {
                const redirectPath &#x3D; this._config.get().services.auth.logoutRedirect;
                this._log.info(&#x27;Redirecting to &#x27; + redirectPath);
                this._router.navigate([redirectPath]);
            }
        });
    }

    get user(): User {
        return this._userService.user;
    }

    get canGoBackLoading$(): Observable&lt;boolean&gt; {
        return this._uriService.parentNodeLoading$;
    }

    /**
     * On home click, the current level is set to 0, and current parent is
     * set to root node.
     * */
    onHomeClick(): void {
        this._uriService.reset();
    }

    /**
     * On back click, the parent is set to parent of left nodes, that will solve
     * the right side menu (elements that were in left side, after backward
     * navigation will be on the right side).
     * Current level is set to a lower number in order to set the left side menu.
     * */
    onBackClick(): void {
        if (this._uriService.isRoot(this.currentNode)) return;
        this._uriService.activeNode &#x3D; this.currentNode.parent;
    }

    onNodeClick(node: UriNodeResource): void {
        this._uriService.activeNode &#x3D; node;
    }

    protected loadLeftSide() {
        if (this._uriService.isRoot(this.currentNode)) {
            this.leftNodes &#x3D; [];
            return;
        }
        this.leftLoading$.on();
        this._leftNodesSubscription &#x3D; this._uriService.getSiblingsOfNode(this.currentNode).subscribe(nodes &#x3D;&gt; {
            this.leftNodes &#x3D; nodes instanceof Array ? nodes : [];
            this.leftNodes.sort((a, b) &#x3D;&gt; this.compareStrings(a.name, b.name));
            this.leftLoading$.off();
        }, error &#x3D;&gt; {
            this._log.error(error);
            this.leftNodes &#x3D; [];
            this.leftLoading$.off();
        });
    }

    protected loadRightSide() {
        this.rightLoading$.on()
        forkJoin({
            folders: this._uriService.getChildNodes(this.currentNode),
            filters: this._uriService.getCasesOfNode(this.currentNode, FILTER_IDENTIFIERS)
        }).subscribe(result &#x3D;&gt; {
            this.rightNodes &#x3D; result.folders instanceof Array ? result.folders : [];
            this.rightNodes.sort((a, b) &#x3D;&gt; this.compareStrings(a.name, b.name));
            this.views &#x3D; (result.filters instanceof Array ? result.filters : []).map(f &#x3D;&gt; this.resolveFilterCaseToViewNavigationItem(f)).filter(i &#x3D;&gt; !!i);
            if (!!this._childCustomViews[this.currentNode.uriPath]) {
                this.views.push(...Object.values(this._childCustomViews[this.currentNode.uriPath]))
            }
            // @ts-ignore
            this.views.sort((a, b) &#x3D;&gt; this.compareStrings(a?.navigation?.title, b?.navigation?.title));
            this.rightLoading$.off();
        }, error &#x3D;&gt; {
            this._log.error(error);
            this.rightNodes &#x3D; [];
            this.views &#x3D; [];
            this.rightLoading$.off();
        });
    }

    protected resolveFilterCaseToViewNavigationItem(filter: Case): ViewNavigationItem | undefined {
        const item: ViewNavigationItem &#x3D; {
            access: {},
            navigation: {
                icon: filter.immediateData.find(f &#x3D;&gt; f.stringId &#x3D;&#x3D;&#x3D; &#x27;icon_name&#x27;)?.value || this.filterIcon,
                title: filter.immediateData.find(f &#x3D;&gt; f.stringId &#x3D;&#x3D;&#x3D; &#x27;entry_name&#x27;)?.value?.defaultValue || filter.title
            },
            routing: {
                path: this.getFilterRoutingPath(filter)
            },
            id: filter.stringId,
            resource: filter
        };
        const resolvedRoles &#x3D; this.resolveAccessRoles(filter);
        if(!!resolvedRoles) item.access[&#x27;role&#x27;] &#x3D; resolvedRoles;
        if (!this._accessService.canAccessView(item, item.routingPath)) return;
        return item;
    }

    protected resolveAccessRoles(filter: Case): Array&lt;RoleAccess&gt; | undefined {
        const allowedRoles &#x3D; filter.immediateData.find(f &#x3D;&gt; f.stringId &#x3D;&#x3D;&#x3D; &#x27;allowed_roles&#x27;)?.options;
        if (!allowedRoles || Object.keys(allowedRoles).length &#x3D;&#x3D;&#x3D; 0) return undefined;
        const roles &#x3D; [];
        Object.keys(allowedRoles).forEach(combined &#x3D;&gt; {
            const parts &#x3D; combined.split(&#x27;:&#x27;);
            roles.push({
                processId: parts[1],
                roleId: parts[0]
            });
        });
        return roles;
    }

    protected getFilterRoutingPath(filterCase: Case) {
        const viewTaskId &#x3D; filterCase.tasks.find(taskPair &#x3D;&gt; taskPair.transition &#x3D;&#x3D;&#x3D; FILTER_VIEW_TASK_TRANSITION_ID).task;
        const url &#x3D; this._dynamicRoutingService.route;
        return &#x60;/${url}/${viewTaskId}&#x60;;
    }

    protected compareStrings(a: string, b: string): number {
        if (!a &amp;&amp; !b) return 0;
        if (a &lt; b) return -1;
        return a &gt; b ? 1 : 0;
    }

    /**
     * Function to check whether the back button should be displayed
     * @returns boolean if the back button should be displayed
     * */
    isOnZeroLevel(): boolean {
        return !!this.currentNode?.level ? this.currentNode.level &#x3D;&#x3D; 0 : true;
    }

    isLeftNodesEmpty(): boolean {
        return this.leftNodes &#x3D;&#x3D;&#x3D; undefined || this.leftNodes.length &#x3D;&#x3D;&#x3D; 0;
    }

    isRightNodesEmpty(): boolean {
        return this.rightNodes &#x3D;&#x3D;&#x3D; undefined || this.rightNodes.length &#x3D;&#x3D;&#x3D; 0;
    }

    isViewsEmpty(): boolean {
        return this.views &#x3D;&#x3D;&#x3D; undefined || this.views.length &#x3D;&#x3D;&#x3D; 0;
    }

    uriNodeTrackBy(index: number, node: UriNodeResource) {
        return node.id;
    }

    viewsTrackBy(index: number, view: ViewNavigationItem) {
        return view.id;
    }

    onResizeEvent(event: ResizeEvent): void {
        if (event.rectangle.width &gt; RIGHT_DRAWER_MAX_WIDTH) {
            this._configRightMenu.width &#x3D; RIGHT_DRAWER_MAX_WIDTH;
        } else if (event.rectangle.width &lt; RIGHT_DRAWER_DEFAULT_MIN_WIDTH) {
            this._configRightMenu.width &#x3D; RIGHT_DRAWER_DEFAULT_MIN_WIDTH;
        } else {
            this._configRightMenu.width &#x3D; event.rectangle.width;
        }
        // TODO implement saving drawer width to user preferences
        // this.userPreferenceService._drawerWidthChanged$.next(this.width);
        // this.contentWidth.next(this.width);
    }

}
</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'ViewNavigationItem.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       
       <script type="module" src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
