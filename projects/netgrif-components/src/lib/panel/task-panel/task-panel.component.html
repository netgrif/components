<nc-app-panel [panelContent]="taskPanelContent" [panelHeader]="taskPanelHeader"
              (stopLoading)="stopLoading()" (getExpansionPanelRef)="setPanelRef($event)" [first]="first" [last]="last">
    <ng-template #taskPanelHeader>
        <div fxLayoutAlign="start center" fxLayout="row" fxFlex="95" (click)="preventSelectionClick($event)">
            <mat-icon class="task-panel-icon panel-primary-icon">
                {{taskPanelData.task.icon ? taskPanelData.task.icon : 'label'}}</mat-icon>
            <div *ngFor="let field of featuredFieldsValues; let i = index" fxFlex
                  class="text-column-div"
                  [fxHide.lt-xl]="i >= 4 && responsiveBody"
                  [fxHide.lt-lg]="i >= 3 && responsiveBody"
                  [fxHide.lt-md]="i >= 2 && responsiveBody"
                  [fxHide.lt-sm]="i >= 1 && responsiveBody"
                    [ngClass]="{'panel-header-padding': !textEllipsis && field.type !== 'button'}">
                <span class="text-column-margin" fxLayoutAlign="start center">
                    <mat-icon class="task-panel-icon panel-primary-icon"
                              *ngIf="!!field.icon && !!field.value && field.type !== 'button'">{{field.icon}}</mat-icon>
                    <ng-container [ngSwitch]="field.type">
                        <span *ngSwitchDefault
                              [ngClass]="{'text-column-ellipsis': textEllipsis, 'text-column-word-wrap': !textEllipsis}"
                              [matTooltip]="field.value"
                              [matTooltipDisabled]="!textEllipsis"
                              [matTooltipClass]="'pre-line-dialog'">{{field.value}}</span>
                        <button *ngSwitchCase="'button'" mat-flat-button color="primary">{{field.value}}</button>
                        <nc-immediate-filter-text *ngSwitchCase="'filter'"
                                                  [filterMetadata]="field.filterMetadata"
                                                  [ellipsis]="textEllipsis"
                                                  class="width-100">
                        </nc-immediate-filter-text>
                    </ng-container>
                </span>
            </div>
        </div>
        <div fxLayout="row" fxLayoutAlign="end center" fxFlex="5">
            <button mat-icon-button (click)="preventPanelOpen($event)"
                    *ngIf="!isLoading && (canAssign() || canDo('delegate') || canReassign() || canCancel() || canFinish())"
                    [matMenuTriggerFor]="menu">
                <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
                <button mat-menu-item *ngIf="canAssign()" (click)="assign()" [disabled]="canDisable('assign')">
                    <mat-icon>person</mat-icon>
                    <span>{{ getAssignTitle() | translate}}</span>
                </button>
                <button mat-menu-item *ngIf="canDo('delegate')" (click)="delegate()"
                        [disabled]="canDisable('delegate')">
                    <mat-icon>person_outline</mat-icon>
                    <span>{{ getDelegateTitle() | translate}}</span>
                </button>
                <button mat-menu-item *ngIf="canReassign()" (click)="delegate()" [disabled]="canDisable('reassign')">
                    <mat-icon>person_add</mat-icon>
                    <span>{{ 'tasks.view.reassign' | translate}}</span>
                </button>
                <button mat-menu-item *ngIf="canCancel()" (click)="cancel()" [disabled]="canDisable('cancel')">
                    <mat-icon>cancel</mat-icon>
                    <span>{{ getCancelTitle() | translate}}</span>
                </button>
                <button mat-menu-item *ngIf="canFinish()" (click)="finish()" [disabled]="canDisable('finish')">
                    <mat-icon>done</mat-icon>
                    <span>{{ getFinishTitle() | translate}}</span>
                </button>
            </mat-menu>
            <mat-spinner *ngIf="isLoading" [diameter]="30"></mat-spinner>
        </div>
    </ng-template>
    <ng-template #taskPanelContent>
        <div class="panel-main-content" fxLayout="column">
            <div class="task-panel-body" [ngClass]="{'paper-view': isPaperView()}" fxFlex="100">
                <ng-template [cdkPortalOutlet]="portal"></ng-template>
            </div>
            <mat-action-row>
                <div fxLayout.lt-sm="column" fxLayoutAlign.lt-sm="center stretch" ngClass.lt-sm="width-100">
                    <button *ngIf="canAssign()" (click)="assign()" mat-button [disabled]="canDisable('assign')">
                        {{ getAssignTitle() | translate | uppercase }}</button>
                    <button *ngIf="canDo('delegate')" (click)="delegate()" mat-button [disabled]="canDisable('delegate')">
                        {{ getDelegateTitle() | translate | uppercase }}</button>
                    <button *ngIf="canReassign()" (click)="delegate()" mat-button [disabled]="canDisable('reassign')">
                        {{ 'tasks.view.reassign' | translate | uppercase }}</button>
                    <button *ngIf="canCancel()" (click)="cancel()" mat-button [disabled]="canDisable('cancel')">
                        {{ getCancelTitle() | translate | uppercase }}</button>
                    <button *ngIf="canFinish()" (click)="finish()" mat-button [disabled]="canDisable('finish')">
                        {{ getFinishTitle() | translate | uppercase }}</button>
                    <button *ngIf="canCollapse()" color="primary" (click)="collapse()" mat-button>
                        {{ 'tasks.view.collapse' | translate | uppercase }}</button>
                </div>
            </mat-action-row>
        </div>
    </ng-template>
</nc-app-panel>
